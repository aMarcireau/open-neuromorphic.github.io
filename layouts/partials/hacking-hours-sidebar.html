<div class="pb-4 text-center">~ Share this Site ~
  {{ partial "override-social-share" (dict "Context" . "Class" "share-icons" "Whatsapp" true "Telegram" false) }}
</div>
<div class="px-7 pt-7 content-panel">
  <h3 class="pb-5 text-xl">Next Hacking Hour</h3>
  {{ $recurringEventData := site.Data.recurring_events.events }}
  {{ $hackingHourEvent := "" }}
  {{ range $recurringEventData }}
  {{ if and (eq .id "hacking-hours") .active }}
  {{ $hackingHourEvent = . }}
  {{ end }}
  {{ end }}

  {{ if $hackingHourEvent }}
  {{ $now := now }}
  {{ $daysMap := dict "Sunday" 0 "Monday" 1 "Tuesday" 2 "Wednesday" 3 "Thursday" 4 "Friday" 5 "Saturday" 6 }}

  {{/* Ensure day_of_week is valid, default to Monday if not found in map to prevent sub error */}}
  {{ $targetDayKey := $hackingHourEvent.day_of_week | default "Monday" }}
  {{ $targetDayIndex := index $daysMap $targetDayKey }}
  {{ if eq $targetDayIndex nil }}{{ $targetDayIndex = 1 }}{{ warnf "Invalid day_of_week '%s' in recurring_events.toml for Hacking Hours. Defaulting to Monday." $hackingHourEvent.day_of_week }}{{ end }}

  {{ $currentDayIndex := int $now.Weekday }}

  {{ $daysToAdd := sub (int $targetDayIndex) (int $currentDayIndex) }}

  {{ if lt $daysToAdd 0 }}
  {{ $daysToAdd = add $daysToAdd 7 }}
  {{ else if eq $daysToAdd 0 }}
  {{ $eventStartHour := int (substr $hackingHourEvent.start_time 0 2) }}
  {{ $eventStartMinute := int (substr $hackingHourEvent.start_time 3 2) }}
  {{ $nowHour := $now.Hour }}
  {{ $nowMinute := $now.Minute }}

  {{ if or (gt $nowHour $eventStartHour) (and (eq $nowHour $eventStartHour) (ge $nowMinute $eventStartMinute)) }}
  {{ $daysToAdd = 7 }}
  {{ end }}
  {{ end }}

  {{ $nextOccurrenceDate := $now.AddDate 0 0 (int $daysToAdd) }}

  <div class="mb-4 pb-6">
    <div>
      <h4 class="font-semibold text-lg">{{ $hackingHourEvent.title }}</h4>
      {{ if $hackingHourEvent.host }}
      <p class="text-sm text-gray-600 dark:text-gray-400">
        Hosted by: {{ $hackingHourEvent.host }}
      </p>
      {{ end }}
      <p class="text-sm mt-1 flex items-center">
          {{ partial "icon.html" (dict "style" "regular" "name" "calendar" "class" "mr-2") }}Next: {{ $nextOccurrenceDate.Format "Mon, Jan 2, 2006" }}
      </p>
      <p class="text-sm flex items-center">
          {{ partial "icon.html" (dict "style" "regular" "name" "clock" "class" "mr-2") }}{{ $hackingHourEvent.start_time }} - {{ $hackingHourEvent.end_time }} {{ $hackingHourEvent.time_zone }}
      </p>
      <p class="text-sm mt-2">
        {{ $hackingHourEvent.description }}
      </p>
      <p class="mt-3">
        <a href="{{ $hackingHourEvent.location_url }}" target="_blank" class="btn btn-sm btn-new-primary">Join on Discord</a>
      </p>
    </div>
  </div>
  {{ else }}
  <p>No active Hacking Hours scheduled in `data/recurring_events.toml`.</p>
  {{ end }}
</div>
