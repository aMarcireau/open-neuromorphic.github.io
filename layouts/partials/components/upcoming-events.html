{{ $events := where .Site.RegularPages "Params.upcoming" "eq" true }}
{{ if $events }}
{{ $sortedUpcomingEvents := slice }}
{{ range $events }}
{{ $sortedUpcomingEvents = $sortedUpcomingEvents | append . }}
{{ end }}
{{ $sortedUpcomingEvents = sort $sortedUpcomingEvents "Params.date" }}
{{ $upcomingCount := len $sortedUpcomingEvents }}
{{ $maxItems := 6 }} <!-- Define the maximum number of items to display -->

{{ range $index, $event := $sortedUpcomingEvents }}
{{ if lt $index $maxItems }}
<!-- split the start time to get hour. subtract 2 from hour -->
      <div class="mb-4">
        <a href="{{ $event.Permalink }}" class="block font-semibold hover:text-primary dark:hover:text-darkmode-primary">{{ $event.Title }}</a>
        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          {{ if .Params.author }}
          <div class="flex items-center">
              {{ partial "icon.html" (dict "style" "regular" "name" "circle-user" "class" "mr-2") }}
              <span>{{ delimit .Params.author ", " }}</span>
          </div>
          {{ end }}
          <div class="flex items-center mt-1">
              {{ partial "icon.html" (dict "style" "regular" "name" "calendar" "class" "mr-2") }}
              <span>{{ dateFormat "2006, Jan 2" $event.Params.Date }}</span>
          </div>
          <div class="flex items-center mt-1">
              {{ partial "icon.html" (dict "style" "regular" "name" "clock" "class" "mr-2") }}
              <span>{{ .Params.start_time }} - {{ .Params.end_time}} {{ $event.Params.time_zone }}</span>
          </div>
        </div>
      </div>
{{ end }}
{{ end }}
{{ else }}
<!-- Handle the case where there are no upcoming events -->
<p>No upcoming events.</p>
{{ end }}
